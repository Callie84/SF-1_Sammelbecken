apiVersion: v1
kind: Secret
metadata:
  name: plausible-secret
  namespace: analytics
stringData:
  SECRET_KEY_BASE: 4f0d5eab0c7a4d9d9d1a0b3c2f7b88aa
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: plausible
  namespace: analytics
spec:
  replicas: 1
  selector:
    matchLabels: { app: plausible }
  template:
    metadata:
      labels: { app: plausible }
    spec:
      containers:
      - name: plausible
        image: plausible/analytics:v2.1
        env:
        - name: BASE_URL
          value: https://analytics.seedfinderpro.de
        - name: SECRET_KEY_BASE
          valueFrom: { secretKeyRef: { name: plausible-secret, key: SECRET_KEY_BASE } }
        - name: DATABASE_URL
          value: postgres://plausible:PlausiblePg!2025@pg.analytics.svc.cluster.local:5432/plausible
        - name: CLICKHOUSE_DATABASE_URL
          value: http://clickhouse.analytics.svc.cluster.local:8123/plausible
        - name: DISABLE_REGISTRATION
          value: "true"
        ports:
        - containerPort: 8000
---
apiVersion: v1
kind: Service
metadata:
  name: plausible
  namespace: analytics
spec:
  selector: { app: plausible }
  ports:
  - port: 80
    targetPort: 8000